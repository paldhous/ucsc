<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>interactive-charts-r.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="from-r-to-interactive-charts-and-maps"><a name="from-r-to-interactive-charts-and-maps" href="#from-r-to-interactive-charts-and-maps"></a>From R to interactive charts and maps</h1><p>Coding online graphics from scratch using JavaScript libraries such as <a href="https://d3js.org/"><strong>D3</strong></a> is a laborious process.</p><p>For standard, reproducible chart types, we will today explore another approach: Making JavaScript visualizations directly from R/RStudio. This is possible thanks to a group of packages collectively known as <a href="http://www.htmlwidgets.org/"><strong>htmlwidgets</strong></a>.</p><p>These packages take instructions in R code, and write the JavaScript and HTML necessary to draw charts using JavaScript visualization libraries. They also allow you to easily export the charts you create in R as responsively designed web pages, which can be embedded in other projects through simple <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><strong>iframes</strong></a>.</p><p>This means you can work in a single environment to both process data and make online charts. Maintaining a simple, streamlined workflow makes it easier to produce graphics quickly on news deadlines.</p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data for this session from <a href="data/week13.zip">here</a>, unzip the folder and place it on your desktop. It contains the following folders and files:</p><ul>
<li><code>nations.csv</code> Data from the World Bank Indicators portal, as used in week 3 and subsequently.</li><li><code>food_stamps.csv</code> <a href="http://www.fns.usda.gov/pd/supplemental-nutrition-assistance-program-snap">U.S. Department of Agriculture data</a> on the number of participants, in millions, and costs, in $ billions, of the federal Supplemental Nutrition Assistance Program from 1969 to 2016, as used in week 8.</li><li><code>seismic.zip</code> Zipped shapefile with data on the risk of a damaging earthquake in 2017 for the continental United States, from the <a href="https://earthquake.usgs.gov/hazards/induced/">U.S. Geological Survey</a>.</li><li><code>test.html</code> Web page to embed the interactive charts and maps we make today.</li></ul><h3 id="setting-up"><a name="setting-up" href="#setting-up"></a>Setting up</h3><p>Launch RStudio, create a new RScript, and set the working directory to the downloaded data folder. Save the script as <code>week13.R</code>.</p><p>First we will install the package <strong>htmlwidgets</strong>, which will make it possible to save the charts and maps we make as web pages:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># install and load htmlwidgets
install.packages(&quot;htmlwidgets&quot;)
library(htmlwidgets)
</code></pre>"><span class="hljs-comment"># install and load htmlwidgets</span>
install.packages(<span class="hljs-string">"htmlwidgets"</span>)
<span class="hljs-keyword">library</span>(htmlwidgets)
</code></pre><h3 id="make-ggplot2-charts-interactive-with-ggiraph"><a name="make-ggplot2-charts-interactive-with-ggiraph" href="#make-ggplot2-charts-interactive-with-ggiraph"></a>Make ggplot2 charts interactive with ggiraph</h3><p><strong><a href="https://davidgohel.github.io/ggiraph/articles/an_introduction.html">ggiraph</a></strong> is a package that adds some simple interactivity to charts made with ggplot2 code.</p><p>The following code loads and installs the package, then loads the food stamps data we used previously to make <strong>ggplot2</strong> charts in week 8.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># install and load ggiraph
install.packages(&quot;ggiraph&quot;)
library(ggiraph)

# load readr, dplyr and ggplot2 packages
library(readr)
library(ggplot2)
library(dplyr)

# load data
food_stamps &amp;lt;- read_csv(&quot;food_stamps.csv&quot;)
</code></pre>"><span class="hljs-comment"># install and load ggiraph</span>
install.packages(<span class="hljs-string">"ggiraph"</span>)
<span class="hljs-keyword">library</span>(ggiraph)

<span class="hljs-comment"># load readr, dplyr and ggplot2 packages</span>
<span class="hljs-keyword">library</span>(readr)
<span class="hljs-keyword">library</span>(ggplot2)
<span class="hljs-keyword">library</span>(dplyr)

<span class="hljs-comment"># load data</span>
food_stamps &lt;- read_csv(<span class="hljs-string">"food_stamps.csv"</span>)
</code></pre><p>Now we will remake the dot-and-line chart from week 8, with some small differences to give hover tooltips showing the program’s cost.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># dot-and-line chart of
food_stamps_chart &amp;lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(&quot;Year&quot;) +
  ylab(&quot;Participants (millions)&quot;) +
  theme_minimal(base_size = 14, base_family = &quot;Georgia&quot;) + 
  geom_line() +
  geom_point_interactive(aes(tooltip = costs))

print(food_stamps_chart)
</code></pre>"><span class="hljs-comment"># dot-and-line chart of</span>
food_stamps_chart &lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(<span class="hljs-string">"Year"</span>) +
  ylab(<span class="hljs-string">"Participants (millions)"</span>) +
  theme_minimal(base_size = <span class="hljs-number">14</span>, base_family = <span class="hljs-string">"Georgia"</span>) + 
  geom_line() +
  geom_point_interactive(aes(tooltip = costs))

print(food_stamps_chart)
</code></pre><p>This code saves a <strong>ggplot2</strong> chart in your environment, as we’ve seen before. But here we used <code>geom_point_interactive</code>, rather than <code>geom_point</code> to add the dots to the chart. Inside this function there is an <code>aes</code> mapping that assigns values from the <code>costs</code> variable to a tooltip. Simply plotting the saved chart gives a standard <strong>ggplot2</strong> chart in the <code>Plots</code> panel at bottom right.</p><p>The following code uses the <code>ggiraph</code> function to turn the saved chart into a web page in which the chart is rendered using D3 as an SVG (scaleable vector graphic) with hover tooltips.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># make interactive version of the chart
food_stamps_interactive &amp;lt;- ggiraph(code = print(food_stamps_chart), height_svg=4)

print(food_stamps_interactive)
</code></pre>"><span class="hljs-comment"># make interactive version of the chart</span>
food_stamps_interactive &lt;- ggiraph(code = print(food_stamps_chart), height_svg=<span class="hljs-number">4</span>)

print(food_stamps_interactive)
</code></pre><p>The code also sets the height of the resulting SVG object to 4 inches using <code>height_svg=4</code>.</p><p>The following chart, with a hover tooltip, should appear in the <code>Viewer</code> panel:</p><p><img src="img/class13_1.jpg" alt=""></p><p>Now we can save the chart as a web page, using the following <strong>htmlwidgets</strong> code:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># save chart as a web page
saveWidget(food_stamps_interactive, &quot;food_stamps.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># save chart as a web page</span>
saveWidget(food_stamps_interactive, <span class="hljs-string">"food_stamps.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>Open the saved web page in your browser and notice that the chart is completely responsive: It will adjust its size to fit the space available.</p><p>Now we will add a hover effect to the points and customize the text and appearance of the tooltip using the following code:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># save plot
food_stamps_chart &amp;lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(&quot;Year&quot;) +
  ylab(&quot;Participants (millions)&quot;) +
  theme_minimal(base_size = 14, base_family = &quot;Georgia&quot;) + 
  geom_line() +
  geom_point_interactive(aes(tooltip=paste0(&quot;cost: @@bodyquot;,costs,&quot; billion&quot;), 
                             data_id = year))

# make interactive version
food_stamps_interactive &amp;lt;- ggiraph(code = print(food_stamps_chart), 
                                   height_svg = 4,
                                   hover_css = &quot;cursor:pointer;fill-opacity:0.5;stroke:red;r:4px&quot;,
                                   tooltip_extra_css = &quot;background-color:#f0f0f0;color:black;padding:5px&quot;)

print(food_stamps_interactive)

# save as web page
saveWidget(food_stamps_interactive, &quot;food_stamps.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># save plot</span>
food_stamps_chart &lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(<span class="hljs-string">"Year"</span>) +
  ylab(<span class="hljs-string">"Participants (millions)"</span>) +
  theme_minimal(base_size = <span class="hljs-number">14</span>, base_family = <span class="hljs-string">"Georgia"</span>) + 
  geom_line() +
  geom_point_interactive(aes(tooltip=paste0(<span class="hljs-string">"cost: $"</span>,costs,<span class="hljs-string">" billion"</span>), 
                             data_id = year))

<span class="hljs-comment"># make interactive version</span>
food_stamps_interactive &lt;- ggiraph(code = print(food_stamps_chart), 
                                   height_svg = <span class="hljs-number">4</span>,
                                   hover_css = <span class="hljs-string">"cursor:pointer;fill-opacity:0.5;stroke:red;r:4px"</span>,
                                   tooltip_extra_css = <span class="hljs-string">"background-color:#f0f0f0;color:black;padding:5px"</span>)

print(food_stamps_interactive)

<span class="hljs-comment"># save as web page</span>
saveWidget(food_stamps_interactive, <span class="hljs-string">"food_stamps.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>This code uses the R function <code>paste0</code> to produce a more useful tooltip, spelling out the costs in billions of dollars. <code>paste0</code> concatenates or pastes together strings of text, separated by commas.</p><p>The <code>geom_point_interactive</code> function now includes <code>data_id = year</code>. Assigning a variable in the data to <code>data_id</code> is necessary to apply hover styling; you should use a variable that uniquely identifies each graphic element to which the hover styling applies — here <code>year</code> works because there is only one point for each year.</p><p>The <code>ggiraph</code> function now includes <code>hover_css</code>, which uses <a href="https://www.w3.org/Style/CSS/Overview.en.html"><strong>CSS</strong></a> (Cascading Style Sheets) code to change the appearance of the points when they are hovered over: This example changes makes the points semitransparent, gives them a red outline, and increases their diameter to 4 pixels.</p><p>The <code>ggiraph</code> function also includes <code>tooltip_extra_css</code>, which here changes the background of the tooltips to a light gray, makes the text black, and adds a padding of 5 pixels around the text.</p><h4 id="embedding-htmlwidgets-in-responsive-iframes"><a name="embedding-htmlwidgets-in-responsive-iframes" href="#embedding-htmlwidgets-in-responsive-iframes"></a>Embedding htmlwidgets in responsive iframes</h4><p>In practice, you will want to embed your interactive charts in other web pages. This can be done using responsive <strong>iframes</strong>.</p><p>Open the <code>test.html</code> web page in a text editor. It contains the following CSS code in beteen <code>&lt;style&gt;&lt;/style&gt;</code> tags:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;style&amp;gt;
.chart-container {
  position: relative;
  height: 0;
  overflow: hidden;
  padding-bottom: 60%
}

.chart-container iframe {
  position: absolute;
  top:0;
  left: 0;
  width: 100%;
  height: 100%;
}
&amp;lt;/style&amp;gt;
</code></pre>">&lt;style&gt;
.chart-container {
  position: relative;
  height: 0;
  overflow: hidden;
  padding-bottom: 60%
}

.chart-container iframe {
  position: absolute;
  top:0;
  left: 0;
  width: 100%;
  height: 100%;
}
&lt;/style&gt;
</code></pre><p>Put each of your charts in a <code>div</code> with <code>class</code> of <code>"chart-container"</code>, like this:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;div class=&quot;chart-container&quot;&amp;gt;

&amp;lt;iframe src=&quot;food_stamps.html&quot; frameborder=&quot;0&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&amp;gt;&amp;lt;/iframe&amp;gt;

&amp;lt;/div&amp;gt;
</code></pre>">&lt;div class="chart-container"&gt;

&lt;iframe src="food_stamps.html" frameborder="0" marginheight="0" marginwidth="0"&gt;&lt;/iframe&gt;

&lt;/div&gt;
</code></pre><p>The CSS should adjust now the size of the iframe to fit the responsive chart.</p><p>You may have to adjust the <code>padding-bottom</code> value depending on the height of your chart; <code>60%</code> should work well here.</p><p>The embed should look like this:</p><div class="chart-container"><br><br><iframe src="food_stamps.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><h4 id="more-ggiraph"><a name="more-ggiraph" href="#more-ggiraph"></a>More ggiraph</h4><p><strong>ggiraph</strong> can be used to apply tooltips and hover styling to the following geometries:</p><ul>
<li><code>geom_bar_interactive</code></li><li><code>geom_boxplot_interactive</code></li><li><code>geom_line_interactive</code></li><li><code>geom_map_interactive</code></li><li><code>geom_path_interactive</code></li><li><code>geom_point_interactive</code></li><li><code>geom_polygon_interactive</code></li><li><code>geom_rect_interactive</code></li><li><code>geom_segment_interactive</code></li><li><code>geom_text_interactive</code></li><li><code>geom_tile_interactive</code></li></ul><p>Here, for example, is the code for a simple interactive column chart:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># create new column for year2, giving year as text rather than numbers
food_stamps &amp;lt;- food_stamps %&amp;gt;%
  mutate(year2 = as.character(year))

# column chart
food_stamps_column &amp;lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(&quot;Year&quot;) +
  ylab(&quot;Participants (millions)&quot;) +
  theme_minimal(base_size = 14, base_family = &quot;Georgia&quot;) + 
  geom_bar_interactive(stat = &quot;identity&quot;, 
         color = &quot;#888888&quot;, 
         fill = &quot;#CCCCCC&quot;, 
         alpha = 0.5,
         aes(tooltip = paste0(&quot;cost: @@bodyquot;,costs, &quot; billion&quot;),
             data_id = year2)) 

# make interactive version of the chart
food_stamps_column_interactive &amp;lt;- ggiraph(code = print(food_stamps_column), 
                                   height_svg = 4,
                                   hover_css = &quot;fill-opacity:1;stroke:red&quot;,
                                   tooltip_extra_css = &quot;background-color:#f0f0f0;color:black;padding:5px&quot;)

# save as a web page
saveWidget(food_stamps_column_interactive, &quot;food_stamps_column.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># create new column for year2, giving year as text rather than numbers</span>
food_stamps &lt;- food_stamps %&gt;%
  mutate(year2 = as.character(year))

<span class="hljs-comment"># column chart</span>
food_stamps_column &lt;- ggplot(food_stamps, aes(x = year, y = participants)) + 
  xlab(<span class="hljs-string">"Year"</span>) +
  ylab(<span class="hljs-string">"Participants (millions)"</span>) +
  theme_minimal(base_size = <span class="hljs-number">14</span>, base_family = <span class="hljs-string">"Georgia"</span>) + 
  geom_bar_interactive(stat = <span class="hljs-string">"identity"</span>, 
         color = <span class="hljs-string">"#888888"</span>, 
         fill = <span class="hljs-string">"#CCCCCC"</span>, 
         alpha = <span class="hljs-number">0.5</span>,
         aes(tooltip = paste0(<span class="hljs-string">"cost: $"</span>,costs, <span class="hljs-string">" billion"</span>),
             data_id = year2)) 

<span class="hljs-comment"># make interactive version of the chart</span>
food_stamps_column_interactive &lt;- ggiraph(code = print(food_stamps_column), 
                                   height_svg = <span class="hljs-number">4</span>,
                                   hover_css = <span class="hljs-string">"fill-opacity:1;stroke:red"</span>,
                                   tooltip_extra_css = <span class="hljs-string">"background-color:#f0f0f0;color:black;padding:5px"</span>)

<span class="hljs-comment"># save as a web page</span>
saveWidget(food_stamps_column_interactive, <span class="hljs-string">"food_stamps_column.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>Some <code>ggiraph</code> geometries may throw an error if you use numerical values for <code>data_id</code>. If this happens, as it does for <code>geom_bar_interactive</code>, just use <strong>dplyr</strong> <code>mutate</code> to create a new variable with numbers converted to text, as above.</p><p>This should be the result of the code above:</p><div class="chart-container"><br><br><iframe src="food_stamps_column.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><h3 id="making-interactive-charts-with-highcharter"><a name="making-interactive-charts-with-highcharter" href="#making-interactive-charts-with-highcharter"></a>Making interactive charts with Highcharter</h3><p><a href="http://jkunst.com/highcharter/index.html"><strong>Highcharter</strong></a> is a package within the <strong>htmlwidgets</strong> framework that connects R to the <a href="http://www.highcharts.com/">Highcharts</a> and <a href="http://www.highcharts.com/products/highstock">Highstock</a> JavaScript visualization libraries. These are free for non-commercial use, but require <a href="https://shop.highsoft.com/highcharts/">paid</a> <a href="https://shop.highsoft.com/highstock">licenses</a> for commercial projects. If you are thinking of pitching to a for-profit news outlet, and want to include a Highcharts or Highstock chart, you will need to make sure that the organization has a license to cover its use.</p><h4 id="install-and-load-required-packages"><a name="install-and-load-required-packages" href="#install-and-load-required-packages"></a>Install and load required packages</h4><p>Install and load <strong>highcharter</strong>, plus <strong><a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf">RColorBrewer</a></strong>, which will make it possible to use <a href="http://colorbrewer2.org">ColorBrewer</a> color palettes.</p><p>Also load <strong>dplyr</strong> for loading and processing data.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># install highcharter, RColorBrewer
install.packages(&quot;highcharter&quot;,&quot;RColorBrewer&quot;)

# load required packages
library(highcharter)
library(RColorBrewer)
</code></pre>"><span class="hljs-comment"># install highcharter, RColorBrewer</span>
install.packages(<span class="hljs-string">"highcharter"</span>,<span class="hljs-string">"RColorBrewer"</span>)

<span class="hljs-comment"># load required packages</span>
<span class="hljs-keyword">library</span>(highcharter)
<span class="hljs-keyword">library</span>(RColorBrewer)
</code></pre><h4 id="load-and-process-nations-data"><a name="load-and-process-nations-data" href="#load-and-process-nations-data"></a>Load and process nations data</h4><p>Load the nations data, and add a column showing GDP in trillions of dollars.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;>nations &amp;lt;- read_csv(&quot;nations.csv&quot;) %&amp;gt;%
  mutate(gdp_tn = gdp_percap*population/10^12)
</code></pre>">nations &lt;- read_csv(<span class="hljs-string">"nations.csv"</span>) %&gt;%
  mutate(gdp_tn = gdp_percap*population/<span class="hljs-number">10</span>^<span class="hljs-number">12</span>)
</code></pre><h4 id="make-a-version-of-the-" china's-rise"-chart-from-the-week-8-assignment"=""><a name="make-a-version-of-the-" china's-rise"-chart-from-the-week-8-assignment"="" href="#make-a-version-of-the-"></a>Make a version of the “China’s rise” chart from the week 8 assignment</h4><p>First, prepare the data using <strong>dplyr</strong>:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># prepare data
big4 &amp;lt;- nations %&amp;gt;%
  filter(iso3c == &quot;CHN&quot; | iso3c == &quot;DEU&quot; | iso3c == &quot;JPN&quot; | iso3c == &quot;USA&quot;) %&amp;gt;%
  arrange(year)
</code></pre>"><span class="hljs-comment"># prepare data</span>
big4 &lt;- nations %&gt;%
  filter(iso3c == <span class="hljs-string">"CHN"</span> | iso3c == <span class="hljs-string">"DEU"</span> | iso3c == <span class="hljs-string">"JPN"</span> | iso3c == <span class="hljs-string">"USA"</span>) %&gt;%
  arrange(year)
</code></pre><p>The <code>arrange</code> step is important, because <strong>highcharter</strong> needs the data in order when drawing a time series — otherwise any line drawn through the data will follow the path of the data order, not the correct time order.</p><p>Now draw a basic chart with default settings:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># basic symbol-and-line chart, default settings
hchart(big4, &quot;line&quot;, hcaes(x = year, y = gdp_tn, group = country))
</code></pre>"><span class="hljs-comment"># basic symbol-and-line chart, default settings</span>
hchart(big4, <span class="hljs-string">"line"</span>, hcaes(x = year, y = gdp_tn, group = country))
</code></pre><p>The following chart should appear in the <code>Viewer</code> panel at bottom right:</p><p><img src="img/class13_2.jpg" alt=""></p><p>In the code above, the function <code>hchart</code>  works similarly to <code>ggplot</code>, and <code>hcaes</code> works like <code>aes</code> in <strong>ggplot2</strong>. Rather than adding geometries, however, you need to define a chart type, here <code>"line"</code>. See <a href="https://www.highcharts.com/docs/chart-and-series-types/chart-types">here</a> for available Highcharts types.</p><p>Now let’s customize this chart:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># define a ColorBrewer palette
cols &amp;lt;- brewer.pal(4, &quot;Set1&quot;)

# make chart
big4_chart &amp;lt;- hchart(big4, &quot;line&quot;, hcaes(x = year, y = gdp_tn, group = country)) %&amp;gt;%
  hc_colors(cols) %&amp;gt;%
  hc_chart(style = list(fontFamily = &quot;Georgia&quot;,
                        fontWeight = &quot;bold&quot;)) %&amp;gt;%
  hc_xAxis(title = list(text=&quot;Year&quot;)) %&amp;gt;%
  hc_yAxis(title = list(text=&quot;GDP ($ trillion)&quot;)) %&amp;gt;%
  hc_plotOptions(series = list(marker = list(enabled = TRUE, symbol = &quot;circle&quot;)))

# plot chart
print(big4_chart)

# save as a web page
saveWidget(big4_chart, &quot;big4.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># define a ColorBrewer palette</span>
cols &lt;- brewer.pal(<span class="hljs-number">4</span>, <span class="hljs-string">"Set1"</span>)

<span class="hljs-comment"># make chart</span>
big4_chart &lt;- hchart(big4, <span class="hljs-string">"line"</span>, hcaes(x = year, y = gdp_tn, group = country)) %&gt;%
  hc_colors(cols) %&gt;%
  hc_chart(style = list(fontFamily = <span class="hljs-string">"Georgia"</span>,
                        fontWeight = <span class="hljs-string">"bold"</span>)) %&gt;%
  hc_xAxis(title = list(text=<span class="hljs-string">"Year"</span>)) %&gt;%
  hc_yAxis(title = list(text=<span class="hljs-string">"GDP ($ trillion)"</span>)) %&gt;%
  hc_plotOptions(series = list(marker = list(enabled = <span class="hljs-literal">TRUE</span>, symbol = <span class="hljs-string">"circle"</span>)))

<span class="hljs-comment"># plot chart</span>
print(big4_chart)

<span class="hljs-comment"># save as a web page</span>
saveWidget(big4_chart, <span class="hljs-string">"big4.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>This should be the result:</p><div class="chart-container"><br><br><iframe src="big4.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><p>Clicking on the legend items allows you to remove or add series from the chart.</p><p><strong>highcharter</strong> uses the <code>%&gt;%</code> or “then” operator, which we have previously used with <strong>dplyr</strong>.</p><p>The first line of the code above sets a palette with four colors, using the “Set1” palette from ColorBrewer. This is then fed to the function <code>hc_colors</code> to use those colors on the chart.</p><p>To set options for the entire chart, such as the fonts used, use the <code>hc_chart</code> function.</p><p>The <code>hc_xAxis</code> and <code>hc_yAxis</code> functions can be used to add axis labels, to set the range of values for an axis, and to add reference lines or bands to a plot. See <a href="http://jkunst.com/highcharter/highcharts-api.html#hc_xaxis-and-hc_yaxis">here</a> for more.</p><h4 id="combine-more-than-one-highcharts-chart-type-into-a-single-chart"><a name="combine-more-than-one-highcharts-chart-type-into-a-single-chart" href="#combine-more-than-one-highcharts-chart-type-into-a-single-chart"></a>Combine more than one Highcharts chart type into a single chart</h4><p>It is also possible to combine different chart types into one, for example columns and dot-and-line.</p><p>The following code does this for the food stamps data, plotting the number of participants as columns and the cost as dot-and-line.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># set colors
cols &amp;lt;- c(&quot;red&quot;,&quot;black&quot;)

# make chart
food_stamps_combined &amp;lt;- highchart() %&amp;gt;%
  hc_add_series(data = food_stamps$participants,
                name = &quot;Participants (millions)&quot;,
                type = &quot;column&quot;) %&amp;gt;%
  hc_add_series(data = food_stamps$costs,
                name = &quot;Costs ($ billions)&quot;,
                type = &quot;line&quot;) %&amp;gt;%
  hc_xAxis(categories = food_stamps$year,
           tickInterval = 5) %&amp;gt;%
  hc_colors(cols) %&amp;gt;%
  hc_chart(style = list(fontFamily = &quot;Georgia&quot;,
                        fontWeight = &quot;bold&quot;))

# plot chart
print(food_stamps_combined)

# save as a web page
saveWidget(food_stamps_combined, &quot;food_stamps_combined.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># set colors</span>
cols &lt;- c(<span class="hljs-string">"red"</span>,<span class="hljs-string">"black"</span>)

<span class="hljs-comment"># make chart</span>
food_stamps_combined &lt;- highchart() %&gt;%
  hc_add_series(data = food_stamps$participants,
                name = <span class="hljs-string">"Participants (millions)"</span>,
                type = <span class="hljs-string">"column"</span>) %&gt;%
  hc_add_series(data = food_stamps$costs,
                name = <span class="hljs-string">"Costs ($ billions)"</span>,
                type = <span class="hljs-string">"line"</span>) %&gt;%
  hc_xAxis(categories = food_stamps$year,
           tickInterval = <span class="hljs-number">5</span>) %&gt;%
  hc_colors(cols) %&gt;%
  hc_chart(style = list(fontFamily = <span class="hljs-string">"Georgia"</span>,
                        fontWeight = <span class="hljs-string">"bold"</span>))

<span class="hljs-comment"># plot chart</span>
print(food_stamps_combined)

<span class="hljs-comment"># save as a web page</span>
saveWidget(food_stamps_combined, <span class="hljs-string">"food_stamps_combined.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>This code uses the <code>highchart</code> function rather than <code>hchart</code>. It works a little differently, but allows you to add different variables for each chart type using the function <code>hc_add_series</code>.</p><p>This should be the result:</p><div class="chart-container"><br><br><iframe src="food_stamps_combined.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><h3 id="financial-charts-using-highstock"><a name="financial-charts-using-highstock" href="#financial-charts-using-highstock"></a>Financial charts using Highstock</h3><p>Highcharts can be used to produce a wide range of charts, including heatmaps and treemaps. Its cousin Highstock is designed specifically to produce time series of financial data, similar to the charts on Yahoo Finance and Google Finance.</p><p>To see this in action, we will first install and load a package called <strong><a href="http://www.quantmod.com/">quantmod</a></strong>, used for financial modeling, which allows you to retrieve stock price data from <a href="https://finance.yahoo.com/">Yahoo Finance</a> or <a href="https://finance.google.com/finance">Google Finance</a>.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># install and load quantmod
install.packages(&quot;quantmod&quot;)
library(quantmod)
</code></pre>"><span class="hljs-comment"># install and load quantmod</span>
install.packages(<span class="hljs-string">"quantmod"</span>)
<span class="hljs-keyword">library</span>(quantmod)
</code></pre><p>The following code retreives stock data for leading technology companies from Yahoo Finance, then draws a Highstocks chart of their daily adjusted closing prices. The <strong>quantmod</strong> package returns R objects called extensible time series or <code>xts</code>. Their contents can be viewed just like data frames in R Studio.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># retrieve data for each company
google &amp;lt;- getSymbols(&quot;GOOG&quot;, src = &quot;yahoo&quot;, auto.assign = FALSE)
facebook &amp;lt;- getSymbols(&quot;FB&quot;, src = &quot;yahoo&quot;, auto.assign = FALSE)
amazon &amp;lt;- getSymbols(&quot;AMZN&quot;, src = &quot;yahoo&quot;, auto.assign = FALSE)

# set color palette
cols &amp;lt;- brewer.pal(3,&quot;Set1&quot;)

# draw chart
stock_chart &amp;lt;- highchart(type = &quot;stock&quot;) %&amp;gt;%
  hc_colors(cols) %&amp;gt;%
  hc_add_series(google$GOOG.Adjusted, name = &quot;Google&quot;) %&amp;gt;%
  hc_add_series(facebook$FB.Adjusted, name = &quot;Facebook&quot;) %&amp;gt;%
  hc_add_series(amazon$AMZN.Adjusted, name = &quot;Amazon&quot;) %&amp;gt;%
  hc_legend(enabled = TRUE,
            verticalAlign = &quot;top&quot;) %&amp;gt;% 
  hc_chart(style = list(fontFamily = &quot;Georgia&quot;,
                        fontWeight = &quot;bold&quot;)) %&amp;gt;%
  hc_tooltip(borderColor = &quot;black&quot;)

# plot chart
print(stock_chart)

# save as web page
saveWidget(stock_chart, &quot;stock_chart.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># retrieve data for each company</span>
google &lt;- getSymbols(<span class="hljs-string">"GOOG"</span>, src = <span class="hljs-string">"yahoo"</span>, auto.assign = <span class="hljs-literal">FALSE</span>)
facebook &lt;- getSymbols(<span class="hljs-string">"FB"</span>, src = <span class="hljs-string">"yahoo"</span>, auto.assign = <span class="hljs-literal">FALSE</span>)
amazon &lt;- getSymbols(<span class="hljs-string">"AMZN"</span>, src = <span class="hljs-string">"yahoo"</span>, auto.assign = <span class="hljs-literal">FALSE</span>)

<span class="hljs-comment"># set color palette</span>
cols &lt;- brewer.pal(<span class="hljs-number">3</span>,<span class="hljs-string">"Set1"</span>)

<span class="hljs-comment"># draw chart</span>
stock_chart &lt;- highchart(type = <span class="hljs-string">"stock"</span>) %&gt;%
  hc_colors(cols) %&gt;%
  hc_add_series(google$GOOG.Adjusted, name = <span class="hljs-string">"Google"</span>) %&gt;%
  hc_add_series(facebook$FB.Adjusted, name = <span class="hljs-string">"Facebook"</span>) %&gt;%
  hc_add_series(amazon$AMZN.Adjusted, name = <span class="hljs-string">"Amazon"</span>) %&gt;%
  hc_legend(enabled = <span class="hljs-literal">TRUE</span>,
            verticalAlign = <span class="hljs-string">"top"</span>) %&gt;% 
  hc_chart(style = list(fontFamily = <span class="hljs-string">"Georgia"</span>,
                        fontWeight = <span class="hljs-string">"bold"</span>)) %&gt;%
  hc_tooltip(borderColor = <span class="hljs-string">"black"</span>)

<span class="hljs-comment"># plot chart</span>
print(stock_chart)

<span class="hljs-comment"># save as web page</span>
saveWidget(stock_chart, <span class="hljs-string">"stock_chart.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><div class="chart-container"><br><br><iframe src="stock_chart.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><p>The time period shown can be filtered using the buttons and date boxes at the top, or the slider at the bottom of the chart.</p><h3 id="make-maps-of-seismic-risk-and-earthquakes-using-leaflet"><a name="make-maps-of-seismic-risk-and-earthquakes-using-leaflet" href="#make-maps-of-seismic-risk-and-earthquakes-using-leaflet"></a>Make maps of seismic risk and earthquakes using Leaflet</h3><p><a href="http://leafletjs.com/">Leaflet</a> is the most widely-used JavaScript library for making interactive online maps. It can be accessed from R using the <a href="http://rstudio.github.io/leaflet/"><strong>leaflet</strong></a> package, another part of the <strong>htmlwidgets</strong> framework. So we need to install and load that, together with a package called <strong><a href="https://cran.r-project.org/web/packages/rgdal/rgdal.pdf">rgdal</a></strong>, which makes it possible to load shapefiles and other geodata into R.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># install and load leaflet and rdgal
install.packages(&quot;leaflet&quot;)
install.packages(&quot;rgdal&quot;)
library(leaflet)
library(rgdal)
</code></pre>"><span class="hljs-comment"># install and load leaflet and rdgal</span>
install.packages(<span class="hljs-string">"leaflet"</span>)
install.packages(<span class="hljs-string">"rgdal"</span>)
<span class="hljs-keyword">library</span>(leaflet)
<span class="hljs-keyword">library</span>(rgdal)
</code></pre><p>We are going to recreate a version of <a href="https://paldhous.github.io/earthquakes/">this map</a>, which I originally coded using Leaflet from scratch. After class, you may wish to download the code for that map from its <a href="https://github.com/paldhous/earthquakes">GitHub repository</a>, to compare with the R version.</p><p>First let’s see how to make a basic Leaflet map, centered on Berkeley:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># make leaflet map centered on Berkeley
leaflet() %&amp;gt;% 
  setView(lng = -122.2705383, lat = 37.8698807, zoom = 11) %&amp;gt;%
  addTiles()
</code></pre>"><span class="hljs-comment"># make leaflet map centered on Berkeley</span>
leaflet() %&gt;% 
  setView(lng = -<span class="hljs-number">122.2705383</span>, lat = <span class="hljs-number">37.8698807</span>, zoom = <span class="hljs-number">11</span>) %&gt;%
  addTiles()
</code></pre><p>This map should appear in the <code>Viewer</code>:</p><p><img src="img/class13_3.jpg" alt=""></p><p>The <code>leaflet</code> function creates a leaflet map.</p><p>The <code>setView</code> function sets the starting position of the map, centering it on the defined coordinates and with the defined zoom level; <code>addTiles</code> adds <a href="https://www.openstreetmap.org/">OpenStreetMap</a> tiles to the map, which would otherwise be blank. Notice that the map is interactive, and can be panned and zoomed just like a Google Map.</p><p>We aren’t limited to using OpenStreetMap tiles:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># make leaflet map centered on Berkeley with Carto tiles
leaflet() %&amp;gt;%
  setView(lng = -122.2705383, lat = 37.8698807, zoom = 11) %&amp;gt;%
  addProviderTiles(&quot;CartoDB.Positron&quot;)
</code></pre>"><span class="hljs-comment"># make leaflet map centered on Berkeley with Carto tiles</span>
leaflet() %&gt;%
  setView(lng = -<span class="hljs-number">122.2705383</span>, lat = <span class="hljs-number">37.8698807</span>, zoom = <span class="hljs-number">11</span>) %&gt;%
  addProviderTiles(<span class="hljs-string">"CartoDB.Positron"</span>)
</code></pre><p>The map should now look like this:</p><p><img src="img/class13_4.jpg" alt=""></p><p>The f<code>addProviderTiles</code> function uses the <a href="https://github.com/leaflet-extras/leaflet-providers">Leaflet Providers</a> plugin to add various tiles to a map. As we discussed in week 11, you can see the available options <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">here</a>.</p><p>Now load the data we need to make the earthquakes map, starting with the <code>seismic</code> shapefile, using the <code>readOGR()</code> function from <strong>rgdal</strong>.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load seismic risk shapefile
seismic &amp;lt;- readOGR(&quot;seismic&quot;, &quot;seismic&quot;)
</code></pre>"><span class="hljs-comment"># load seismic risk shapefile</span>
seismic &lt;- readOGR(<span class="hljs-string">"seismic"</span>, <span class="hljs-string">"seismic"</span>)
</code></pre><p>The two mentions of <code>seismic</code> refer to the folder and the shapefile within it, respectively.</p><p>You should now have in your environment an object called <code>seismic</code> which is a <code>SpatialPolygonsDataFrame</code>.</p><p>We can also load data on earthquakes, directly from the U.S. Geological Survey API described in the notes for week 5:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load quakes data from USGS earthquakes API
quakes &amp;lt;- read_csv(&quot;https://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;minmagnitude=6&amp;amp;format=csv&amp;amp;latitude=39.828175&amp;amp;longitude=-98.5795&amp;amp;maxradiuskm=6000&amp;amp;orderby=magnitude&quot;)
</code></pre>"><span class="hljs-comment"># load quakes data from USGS earthquakes API</span>
quakes &lt;- read_csv(<span class="hljs-string">"https://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;minmagnitude=6&amp;format=csv&amp;latitude=39.828175&amp;longitude=-98.5795&amp;maxradiuskm=6000&amp;orderby=magnitude"</span>)
</code></pre><p>Using this url, we have loaded earthquakes since the start of 1960 that had a magnitude of 6 and above, within a 6,000 kilometer radius of the geographic center of the continental United States.</p><p>Let’s look at a summary of the <code>seismic</code> data:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># view summary of seismic_risk data
summary(seismic)
</code></pre>"><span class="hljs-comment"># view summary of seismic_risk data</span>
summary(seismic)
</code></pre><p>This should be returned in the R Console:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;>Object of class SpatialPolygonsDataFrame
Coordinates:
      min       max
x -124.71 -66.98701
y   24.60  49.36968
Is projected: FALSE 
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
Data attributes:
   ValueRange
 &amp;lt; 1    : 3  
 1 - 2  :12  
 10 - 12: 2  
 2 - 5  : 8  
 5 - 10 : 4
</code></pre>">Object of class SpatialPolygonsDataFrame
Coordinates:
      min       max
x -<span class="hljs-number">124.71</span> -<span class="hljs-number">66.98701</span>
y   <span class="hljs-number">24.60</span>  <span class="hljs-number">49.36968</span>
Is projected: <span class="hljs-literal">FALSE</span> 
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
Data attributes:
   ValueRange
 &lt; <span class="hljs-number">1</span>    : <span class="hljs-number">3</span>  
 <span class="hljs-number">1</span> - <span class="hljs-number">2</span>  :<span class="hljs-number">12</span>  
 <span class="hljs-number">10</span> - <span class="hljs-number">12</span>: <span class="hljs-number">2</span>  
 <span class="hljs-number">2</span> - <span class="hljs-number">5</span>  : <span class="hljs-number">8</span>  
 <span class="hljs-number">5</span> - <span class="hljs-number">10</span> : <span class="hljs-number">4</span>
</code></pre><p>The data defining the annual risk of a damaging earthquake is in the variable <code>ValueRange</code>. But as you may remember from our previous mapping classes, the categories of this binned variable are not in the right order. To correct that, we should convert the variable from text to a <code>factor</code>, or categorical variable, and then change the order, using an R package called <strong><a href="https://cran.r-project.org/web/packages/forcats/forcats.pdf">forcats</a></strong>, which is part of the <strong>tidyverse</strong>.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load required package
library(forcats)

# convert to factor/categorical variable
seismic$ValueRange &amp;lt;- as.factor(seismic$ValueRange)

# reorder the levels of the factor
seismic$ValueRange &amp;lt;- fct_relevel(seismic$ValueRange, c(&quot;&amp;lt; 1&quot;,&quot;1 - 2&quot;,&quot;2 - 5&quot;,&quot;5 - 10&quot;, &quot;10 - 12&quot;))

# view summary of seismic_risk data
summary(seismic)
</code></pre>"><span class="hljs-comment"># load required package</span>
<span class="hljs-keyword">library</span>(forcats)

<span class="hljs-comment"># convert to factor/categorical variable</span>
seismic$ValueRange &lt;- as.factor(seismic$ValueRange)

<span class="hljs-comment"># reorder the levels of the factor</span>
seismic$ValueRange &lt;- fct_relevel(seismic$ValueRange, c(<span class="hljs-string">"&lt; 1"</span>,<span class="hljs-string">"1 - 2"</span>,<span class="hljs-string">"2 - 5"</span>,<span class="hljs-string">"5 - 10"</span>, <span class="hljs-string">"10 - 12"</span>))

<span class="hljs-comment"># view summary of seismic_risk data</span>
summary(seismic)
</code></pre><p>Now the categories should be in the correct order:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;>Object of class SpatialPolygonsDataFrame
Coordinates:
      min       max
x -124.71 -66.98701
y   24.60  49.36968
Is projected: FALSE 
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0]
Data attributes:
   ValueRange
 &amp;lt; 1    : 3  
 1 - 2  :12  
 2 - 5  : 8  
 5 - 10 : 4  
 10 - 12: 2
</code></pre>">Object of class SpatialPolygonsDataFrame
Coordinates:
      min       max
x -<span class="hljs-number">124.71</span> -<span class="hljs-number">66.98701</span>
y   <span class="hljs-number">24.60</span>  <span class="hljs-number">49.36968</span>
Is projected: <span class="hljs-literal">FALSE</span> 
proj4string :
[+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
Data attributes:
   ValueRange
 &lt; <span class="hljs-number">1</span>    : <span class="hljs-number">3</span>  
 <span class="hljs-number">1</span> - <span class="hljs-number">2</span>  :<span class="hljs-number">12</span>  
 <span class="hljs-number">2</span> - <span class="hljs-number">5</span>  : <span class="hljs-number">8</span>  
 <span class="hljs-number">5</span> - <span class="hljs-number">10</span> : <span class="hljs-number">4</span>  
 <span class="hljs-number">10</span> - <span class="hljs-number">12</span>: <span class="hljs-number">2</span>
</code></pre><p>Now we will load the seismic risk data into a leaflet map:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load the seismic risk data into a leaflet map
seismic_map &amp;lt;- leaflet(data=seismic)
</code></pre>"><span class="hljs-comment"># load the seismic risk data into a leaflet map</span>
seismic_map &lt;- leaflet(data=seismic)
</code></pre><p>You should now see an object of type <code>leaflet</code> in your environment.</p><p>Now we can make a map with two layers just a few lines of code:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># set color palette
pal &amp;lt;- colorFactor(&quot;Reds&quot;, seismic$ValueRange)

# plot map
seismic_map %&amp;gt;%
  setView(lng = -98.5795, lat = 39.828175, zoom = 4) %&amp;gt;%
  addProviderTiles(&quot;CartoDB.Positron&quot;) %&amp;gt;% 
  addPolygons(
    stroke = FALSE,
    fillOpacity = 0.7,
    smoothFactor = 0.1,
    color = ~pal(ValueRange)
  ) %&amp;gt;%
  # add historical earthquakes
  addCircles(
    data = quakes, 
    radius = sqrt(10^quakes$mag)*30, 
    color = &quot;#000000&quot;,
    weight = 0.2,
    fillColor =&quot;#ffffff&quot;,
    fillOpacity = 0.5,
    popup = paste0(&quot;&amp;lt;strong&amp;gt;Magnitude: &amp;lt;/strong&amp;gt;&quot;, quakes$mag, &quot;&amp;lt;/br&amp;gt;&quot;,
                   &quot;&amp;lt;strong&amp;gt;Date: &amp;lt;/strong&amp;gt;&quot;, format(as.Date(quakes$time), &quot;%b %d, %Y&quot;))
  )
</code></pre>"><span class="hljs-comment"># set color palette</span>
pal &lt;- colorFactor(<span class="hljs-string">"Reds"</span>, seismic$ValueRange)

<span class="hljs-comment"># plot map</span>
seismic_map %&gt;%
  setView(lng = -<span class="hljs-number">98.5795</span>, lat = <span class="hljs-number">39.828175</span>, zoom = <span class="hljs-number">4</span>) %&gt;%
  addProviderTiles(<span class="hljs-string">"CartoDB.Positron"</span>) %&gt;% 
  addPolygons(
    stroke = <span class="hljs-literal">FALSE</span>,
    fillOpacity = <span class="hljs-number">0.7</span>,
    smoothFactor = <span class="hljs-number">0.1</span>,
    color = ~pal(ValueRange)
  ) %&gt;%
  <span class="hljs-comment"># add historical earthquakes</span>
  addCircles(
    data = quakes, 
    radius = sqrt(<span class="hljs-number">10</span>^quakes$mag)*<span class="hljs-number">30</span>, 
    color = <span class="hljs-string">"#000000"</span>,
    weight = <span class="hljs-number">0.2</span>,
    fillColor =<span class="hljs-string">"#ffffff"</span>,
    fillOpacity = <span class="hljs-number">0.5</span>,
    popup = paste0(<span class="hljs-string">"&lt;strong&gt;Magnitude: &lt;/strong&gt;"</span>, quakes$mag, <span class="hljs-string">"&lt;/br&gt;"</span>,
                   <span class="hljs-string">"&lt;strong&gt;Date: &lt;/strong&gt;"</span>, format(as.Date(quakes$time), <span class="hljs-string">"%b %d, %Y"</span>))
  )
</code></pre><p><img src="img/class13_5.jpg" alt=""></p><p>The function <code>addPolygons</code> adds polygons to the map: <code>stroke = FALSE</code> gives them no outline; <code>fillOpacity = 0.7</code> makes them slightly transparent; <code>color = ~pal(ValueRange))</code> uses the color palette and breaks we set up earlier to color the polygons according to values in the <code>ValueRange</code> data.</p><p>(To see how to set up a color palette for a continuous variable, see <a href="http://peteraldhous.com/ucb/2016/dataviz/week13.html">this class</a> from last year.)</p><p><code>smoothFactor</code> controls the extent to which the polygons are simplified. See what happens to the map if you replace <code>0.1</code> with <code>10</code>. Simplified polygons will load more quickly, but there’s a tradeoff with the appearance of the map. Choose an appropriate value for your maps through trial and error.</p><p><code>addCircles</code> adds circles to the map, using the <code>quakes</code> data; <code>color</code> sets the color for their outlines, while <code>weight</code> sets the thickness of these lines; <code>fillColor</code> and <code>fillOpacity</code> style the circles’ interiors.</p><p>The size of the circles is set by <code>radius = sqrt(quakes$mag^10)*30</code>. Here <code>30</code> is simply a scaling factor for all of the circles, set by trial and error to give a reasonable appearance on the map. The size of the circles is set from the variable <code>mag</code> in the quakes data, which is their magnitude. We have raised 10 to the power of these magnitude values: Again, this is a quirk of working with earthquake magnitudes, which are on a logarithmic scale, so that a magnitude difference of 1 corresponds to a 10-fold difference in earth movement, as recorded on a seismogram.</p><p>When scaling circles, use the values from the data, and then take their square roots, using the <code>sqrt</code> function. This is important, to ensure that the circles are scaled correctly, by area, rather than by radius, as we discussed in Week 2.</p><p><code>popup</code> is used to define the HTML code the appears in the popup that appears when any quake is clicked or tapped. The code above uses the R function <code>paste</code> to paste together a series of elements, separated by commas, that will write the HTML. They include the <code>mag</code> and <code>time</code> values from the quakes data, the latter being formatted as an easy-to-read date using R’s <code>format</code> function for dates. See <a href="https://www.statmethods.net/input/dates.html">here</a> for more on formatting dates in R.</p><p>We can add a legend, and a layer control to turn the quakes layer on and off, and switch between different basemaps, by extending the code further:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># make multi-layered leaflet map with legend and layer-switching control
seismic_final &amp;lt;- seismic_map %&amp;gt;%
  setView(lng = -98.5795, lat = 39.828175, zoom = 4) %&amp;gt;%
  addProviderTiles(&quot;CartoDB.Positron&quot;, group = &quot;Carto&quot;) %&amp;gt;% 
  addProviderTiles(&quot;Stamen.TonerLite&quot;, group = &quot;Toner&quot;) %&amp;gt;%
  addPolygons(
    stroke = FALSE,
    fillOpacity = 0.7,
    smoothFactor = 0.1,
    color = ~pal(ValueRange),
    popup = seismic$ValueRange
  ) %&amp;gt;%
  # add historical earthquakes
  addCircles(
    data = quakes, 
    radius = sqrt(10^quakes$mag)*30, 
    color = &quot;#000000&quot;,
    weight = 0.2,
    fillColor =&quot;#ffffff&quot;,
    fillOpacity = 0.5,
    popup = paste0(&quot;&amp;lt;strong&amp;gt;Magnitude: &amp;lt;/strong&amp;gt;&quot;, quakes$mag, &quot;&amp;lt;/br&amp;gt;&quot;,
                   &quot;&amp;lt;strong&amp;gt;Date: &amp;lt;/strong&amp;gt;&quot;, format(as.Date(quakes$time), &quot;%b %d, %Y&quot;)),
    group = &quot;Quakes&quot;
  ) %&amp;gt;%
  # add legend
  addLegend(
    &quot;bottomright&quot;, pal = pal, values = ~ValueRange,
    title = &quot;% risk of damaging quake in 2017&quot;,
    opacity = 0.7,
    labels = labels
  ) %&amp;gt;%
  # add layers control
  addLayersControl(
    baseGroups = c(&quot;Toner&quot;,&quot;Carto&quot;),
    overlayGroups = &quot;Quakes&quot;,
    options = layersControlOptions(collapsed = FALSE)
  )

# plot the map
print(seismic_final)

# save the map
saveWidget(seismic_final, &quot;seismic.html&quot;, selfcontained = TRUE, libdir = NULL, background = &quot;white&quot;)
</code></pre>"><span class="hljs-comment"># make multi-layered leaflet map with legend and layer-switching control</span>
seismic_final &lt;- seismic_map %&gt;%
  setView(lng = -<span class="hljs-number">98.5795</span>, lat = <span class="hljs-number">39.828175</span>, zoom = <span class="hljs-number">4</span>) %&gt;%
  addProviderTiles(<span class="hljs-string">"CartoDB.Positron"</span>, group = <span class="hljs-string">"Carto"</span>) %&gt;% 
  addProviderTiles(<span class="hljs-string">"Stamen.TonerLite"</span>, group = <span class="hljs-string">"Toner"</span>) %&gt;%
  addPolygons(
    stroke = <span class="hljs-literal">FALSE</span>,
    fillOpacity = <span class="hljs-number">0.7</span>,
    smoothFactor = <span class="hljs-number">0.1</span>,
    color = ~pal(ValueRange),
    popup = seismic$ValueRange
  ) %&gt;%
  <span class="hljs-comment"># add historical earthquakes</span>
  addCircles(
    data = quakes, 
    radius = sqrt(<span class="hljs-number">10</span>^quakes$mag)*<span class="hljs-number">30</span>, 
    color = <span class="hljs-string">"#000000"</span>,
    weight = <span class="hljs-number">0.2</span>,
    fillColor =<span class="hljs-string">"#ffffff"</span>,
    fillOpacity = <span class="hljs-number">0.5</span>,
    popup = paste0(<span class="hljs-string">"&lt;strong&gt;Magnitude: &lt;/strong&gt;"</span>, quakes$mag, <span class="hljs-string">"&lt;/br&gt;"</span>,
                   <span class="hljs-string">"&lt;strong&gt;Date: &lt;/strong&gt;"</span>, format(as.Date(quakes$time), <span class="hljs-string">"%b %d, %Y"</span>)),
    group = <span class="hljs-string">"Quakes"</span>
  ) %&gt;%
  <span class="hljs-comment"># add legend</span>
  addLegend(
    <span class="hljs-string">"bottomright"</span>, pal = pal, values = ~ValueRange,
    title = <span class="hljs-string">"% risk of damaging quake in 2017"</span>,
    opacity = <span class="hljs-number">0.7</span>,
    labels = labels
  ) %&gt;%
  <span class="hljs-comment"># add layers control</span>
  addLayersControl(
    baseGroups = c(<span class="hljs-string">"Toner"</span>,<span class="hljs-string">"Carto"</span>),
    overlayGroups = <span class="hljs-string">"Quakes"</span>,
    options = layersControlOptions(collapsed = <span class="hljs-literal">FALSE</span>)
  )

<span class="hljs-comment"># plot the map</span>
print(seismic_final)

<span class="hljs-comment"># save the map</span>
saveWidget(seismic_final, <span class="hljs-string">"seismic.html"</span>, selfcontained = <span class="hljs-literal">TRUE</span>, libdir = <span class="hljs-literal">NULL</span>, background = <span class="hljs-string">"white"</span>)
</code></pre><p>The final map should look like this:</p><div class="chart-container"><br><br><iframe src="seismic.html" frameborder="0" marginheight="0" marginwidth="0"></iframe><br><br></div><p>I hope these examples illustrate the potential of <strong>htmlwidgets</strong>. There are many more which we have not covered. Understanding how the code for each will take some time. But if you follow the documentation, the results can be impressive.</p><h3 id="further-reading/resources"><a name="further-reading/resources" href="#further-reading/resources"></a>Further reading/resources</h3><p><a href="http://www.htmlwidgets.org/showcase_leaflet.html">htmlwidgets Showcase</a><br>Links to documentation and code examples for the leading htmlwidgets.</p><p><a href="http://gallery.htmlwidgets.org/">htmlwidgets Gallery</a><br>A more extensive collection of htmlwidgets</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
