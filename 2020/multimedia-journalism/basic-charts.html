<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Multimedia Journalism: Data Viz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../css/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/custom2.css" rel="stylesheet">
</head>

<body class="markdown github">

	<header class="navbar-inverse navbar-fixed-top">
		<div class="container">
			<nav role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="index.html" class="navbar-brand">Multimedia Journalism: Data Viz</a>
				</div> <!-- /.navbar-header -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Class notes<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="principles.html">Basic principles of data analysis and visualization</a></li>
								<li><a href="acquiring-data.html">Finding and downloading data</a></li>
								<li><a href="cleaning-data.html">Processing and cleaning data</a></li>
								<li><a href="basic-charts.html">Basic charts with Plotly</a></li>
								<li><a href="data-processing-r.html">Processing data with R</a></li>
								<li><a href="static-charts-r.html">Static charts with R</a></li>
								<li><a href="interactive-charts-r.html">Interactive charts with R</a></li>
								<li><a href="animations-r.html">Animation: GIFs and videos from R</a></li>
							</ul>
						</li>
						<li>
						<li><a href="software.html">Software</a></li>
						<li><a href="data.html">Data</a></li>
						<li><a href="mailto:p.aldhous@gmail.com">Email instructor</a></li>					
					</ul>
				</div><!-- /.navbar-collapse -->
			</nav>
		</div> <!-- /.navbar-header -->
	</header>

	<div class="container all">

<h1 id="basic-charts-with-plotly"><a name="basic-charts-with-plotly" href="#basic-charts-with-plotly"></a>Basic charts with Plotly</h1>
<h3 id="introducing-plotly"><a name="introducing-plotly" href="#introducing-plotly"></a>Introducing Plotly</h3>
<p>In today’s class we will make a series of simple charts using <a href="https://plot.ly/online-chart-maker/"><strong>Plotly</strong></a> Chart Studio, a web application that allows you to upload data and use a point-and-click interface to make online charts, with tooltips and other interactivity. These can be embedded in your web projects, or exported as static images.</p>
<h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3>
<p>Download the data for this session from <a href="data/basic-charts.zip">here</a>, unzip the folder and place it on your desktop. It contains the following files:</p>
<ul>
<li><p><code>food_stamps.csv</code> Contains the following variables:</p>
<ul>
<li><code>year</code> From 1969 to 2016.</li><li><code>food_stamps</code> Average number of people participating in the Supplemental Nutrition Assistance Program, in millions, from the <a href="https://www.fns.usda.gov/pd/supplemental-nutrition-assistance-program-snap">US Department of Agriculture</a>.</li><li><code>poverty</code> Estimated number of people in poverty, in millions, from the <a href="https://census.gov/content/dam/Census/library/publications/2017/demo/P60-259.pdf">US Census Bureau</a>.</li></ul>
</li><li><p><code>nations_2017.csv</code> Data from the <a href="https://data.worldbank.org/indicator/?tab=all">World Bank Indicators</a> portal. Contains the following fields:</p>
<ul>
<li><code>iso2c</code> <code>iso3c</code> Two- and three-letter <a href="https://www.nationsonline.org/oneworld/country_code_list.htm">codes</a> for each country, assigned by the <a href="https://www.iso.org/standard/63545.html">International Organization for Standardization</a>.</li><li><code>country</code> Country name.</li><li><code>year</code> 2017 for this data.</li><li><code>gdp_percap</code> <a href="https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.CD">Gross Domestic Product per capita</a> in current international dollars, corrected for purchasing power in different territories.</li><li><code>life_expect</code> <a href="https://data.worldbank.org/indicator/SP.DYN.LE00.IN">Life expectancy at birth</a>, in years.</li><li><code>population</code> Estimated <a href="https://data.worldbank.org/indicator/SP.POP.TOTL">total population</a> at mid-year, including all residents apart from refugees.</li><li><code>region</code> <code>income</code> World Bank <a href="http://siteresources.worldbank.org/DATASTATISTICS/Resources/CLASS.XLS">regions and income groups</a>, explained <a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/906519">here</a>.</li></ul>
</li><li><p><code>test.html</code> A web page for embedding online charts. It has been set up using the <a href="https://getbootstrap.com/">Bootstrap</a> responsive web design framework so that any content will automatically adjust to the size of the browser window in which it is viewed, centered on the page.</p>
</li></ul>
<h3 id="log-in-to-plotly"><a name="log-in-to-plotly" href="#log-in-to-plotly"></a>Log in to Plotly</h3>
<p>Log in to Plotly <a href="https://plot.ly/Auth/login/#/">here</a>:</p>
<p><img src="./img/basic_charts_1.jpg" alt=""></p>
<p>You should now see a screen like this:</p>
<p><img src="./img/basic_charts_2.jpg" alt=""></p>
<h3 id="make-a-bar-chart-showing-number-of-people-enrolled-in-food-stamps-program-over-time"><a name="make-a-bar-chart-showing-number-of-people-enrolled-in-food-stamps-program-over-time" href="#make-a-bar-chart-showing-number-of-people-enrolled-in-food-stamps-program-over-time"></a>Make a bar chart showing number of people enrolled in food stamps program over time</h3>
<p>Having logged in to Plotly, click on the <code>New</code> or <code>+ Create</code> buttons and select <code>Chart</code> to see this screen: </p>
<p><img src="./img/basic_charts_3.jpg" alt=""></p>
<p>The <code>Grid</code> table shows the data to be visualized, so first import the file <code>food_stamps.csv</code> by clicking the <code>Import</code> buttom at top right. This will open the following dialog box:</p>
<p><img src="./img/basic_charts_4.jpg" alt=""></p>
<p>In the <code>Upload</code> tab, click the <code>Upload</code> button and navigate to the folder containing the file, or drag the file onto the dialog box.</p>
<p>Your workspace should now look like this, with the imported data in a new <code>Grid</code>:</p>
<p><img src="./img/basic_charts_5.jpg" alt=""></p>
<p>You build charts by adding variables to the plot using the <code>+ Trace</code> button. The default is a <code>Scatter plot</code>, but if you click on that box, you will see the other possibilities:</p>
<p><img src="./img/basic_charts_6.jpg" alt=""></p>
<p>Select <code>Bar</code> and map <code>year</code> onto the X axis and <code>food_stamps</code> onto the <code>Y</code> to create the default chart:</p>
<p><img src="./img/basic_charts_7.jpg" alt=""></p>
<p>You can build charts with multiple layers, for example here adding a dot-and-line to show the number of people living in poverty, by adding additional <code>Traces</code>. But we will proceed with a simple column chart.</p>
<p>So far we have been working in the <code>Structure</code> section of the main left-hand menu, under the <code>Traces</code> tab. This also contains a <code>Subplots</code> tab, to create multiple charts from different <code>Traces</code> within the same panel; and a <code>Transforms</code> tab, which allows you to <code>Filter</code>, <code>Aggregate</code> (summarize) or <code>Sort</code> the data for a <code>Trace</code> (see the section on basic operations with data from the first class). <code>Split</code> will group the data by a categorical variable.</p>
<p>Having made a basic chart, you can customize it by choosing an overall <code>Theme</code>, and then opening up the options in the <code>Style</code> section of the menu. We will keep the default <code>Theme</code>.</p>
<p>In the <code>Style</code> menu, <code>General</code> contains an option to change the size of the chart. I recommend keeping it set to <code>Auto</code>, as this allows the chart to be responsive, altering its size to fit the available space when embedded into a web page. This section also allows you to add a plot title, and to customize the font faces and size, and to customize the tooltips. If you don’t wish your chart to have tooltips, select <code>Disable</code> under <code>Hover&gt;Mode</code>. We will change the <code>Text&gt;Typeface</code> to <code>Arial</code>, which should display in all browsers when we later download as a web page.</p>
<p>The available options to customize in the <code>Traces</code> tab depend on the chart type. Common options include  customizing color and opacity. For bar or column charts you can also change bar widths and the padding around them. We will simply change the default blue color to a bright red, using the HEX value <code>FF0000</code>:</p>
<p><img src="./img/basic_charts_8.jpg" alt=""></p>
<p>The <code>Axes</code> tab contains options for customizing the <code>X</code> and <code>Y</code> axes. It contains options to set the <code>Range</code> of each axis, to show or hide grid and zero lines under <code>Lines</code>, and to customize <code>Tick Labels</code> and <code>Tick Markers</code>. <code>Range Slider</code> adds a control to adjust the range shown on the X axis, which can be useful to zoom in on the details for very long time series.  You will usually want to adjust the axis <code>Titles</code>; Here, edit the Y axis title to <code>Participants (millions)</code>.</p>
<p><img src="./img/basic_charts_9.jpg" alt=""></p>
<p>The <code>Legend</code> tab allows you to customize the color legend for charts that need them, superfluous here.</p>
<p>The <code>Annotate</code> menu allows you to annotate the chart in various ways. </p>
<p><code>Text</code> allows you to add text annotations.</p>
<p><code>Shapes</code> provides options to add reference lines or bands to your chart; use in combination with <code>Text</code> as required for chart annotation. (If you need to add a trend line to a scatter plot, use <code>Curve Fitting</code> under the <code>Analyze</code> menu.)</p>
<p><code>Images</code> allows you to add images, such as an organization’s logo, to a chart.</p>
<p>Having finished customizing your chart, hit the <code>Save</code> button, then save both <code>Plot</code> and <code>Grid</code> as <code>Public</code> (<code>Private</code> is not available for free accounts):</p>
<p><img src="./img/basic_charts_10.jpg" alt=""></p>
<h3 id="export-and-share-the-chart"><a name="export-and-share-the-chart" href="#export-and-share-the-chart"></a>Export and share the chart</h3>
<p>Having saved your chart, select the <code>Image</code> tab under the  <code>Export</code> export to save it as a PNG image, setting the desired height and width in pixels:</p>
<p><img src="./img/basic_charts_11.jpg" alt=""></p>
<p>Click <code>Download</code> to save the PNG image file to you computer. (Saving in PDF, SVG, and EPS formats, which will give a graphic that can edited in a vector graphics editor such as <a href="https://www.adobe.com/products/illustrator.html">Adobe Illustrator</a>, is possible only with a paid account.)</p>
<p>For a simple embed, click the <code>Share</code> button and switch to the <code>Embed</code> tab to obtain an <a href="https://www.w3schools.com/html/html_iframe.asp"><strong>iframe</strong></a> code:</p>
<p><img src="./img/basic_charts_12.jpg" alt=""></p>
<p>Copy the embed code, then open the <code>test.html</code> file in <a href="https://www.sublimetext.com/">Sublime Text</a>. Insert the code into the page and edit as follows:</p>
<pre><code class="Javascript">  &lt;div class=&quot;container&quot;&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;500&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; src=&quot;https://plot.ly/~paldhous/328.embed&quot;&gt;&lt;/iframe&gt;

  &lt;/div&gt; &lt;!-- /.container --&gt;
</code></pre>
<p>An iframe allows you to embed one web page, here displaying your chart on Plotly’s servers, into another. Set its height in pixels, and its width as <code>100%</code>. This will allow the chart width to adjust for different browser window sizes. You may also need to insert <code>https:</code> at the start of the web address.</p>
<p>A <code>div</code> is a distinct section of a webpage. Insert the iframe into the div with the class <code>container</code>. This is a feature of Bootstrap that will center the embed on you page, optimized for different browser window sizes.</p>
<p>Save the page and open it in your web browser:</p>
<p><img src="./img/basic_charts_13.jpg" alt=""></p>
<p>A default Plotly embed contains an <code>EDIT CHART</code> link, allowing other users to edit the chart using their own Plotly account. When you hover over the chart, various controls appear at top right.</p>
<p>To obtain an embed without these features, which I would recommend, select <code>Export</code> once more, switch to the <code>HTML</code> tab, and <code>Download as Html file</code>:</p>
<p><img src="./img/basic_charts_14.jpg" alt=""></p>
<p>Place the downloaded file in your working folder for this class and rename it as <code>food-stamps-column.html</code>. Open in Sublime Text, scroll to the bottom of the file, and edit as follows:</p>
<p><strong>Before:</strong></p>
<pre><code class="Javascript"> config: {&quot;showLink&quot;: true, &quot;linkText&quot;: &quot;Export to plot.ly&quot;, &quot;mapboxAccessToken&quot;: &quot;pk.eyJ1IjoiY2hyaWRkeXAiLCJhIjoiY2lxMnVvdm5iMDA4dnhsbTQ5aHJzcGs0MyJ9.X9o_rzNLNesDxdra4neC_A&quot;}
</code></pre>
<p><strong>After:</strong></p>
<pre><code class="Javascript">config: {&quot;showLink&quot;: false, &quot;displayModeBar&quot;: false, &quot;linkText&quot;: &quot;Export to plot.ly&quot;, &quot;mapboxAccessToken&quot;: &quot;pk.eyJ1IjoiY2hyaWRkeXAiLCJhIjoiY2lxMnVvdm5iMDA4dnhsbTQ5aHJzcGs0MyJ9.X9o_rzNLNesDxdra4neC_A&quot;}
</code></pre>
<p>Now open <code>test.html</code> once more and edit the iframe to embed the downloaded web page:</p>
<pre><code class="Javascript">  &lt;div class=&quot;container&quot;&gt;

    &lt;iframe width=&quot;100%&quot; height=&quot;500&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; src=&quot;food-stamps-column.html&quot;&gt;&lt;/iframe&gt;

  &lt;/div&gt; &lt;!-- /.container --&gt;
</code></pre>
<p>You should now have the following clean embed:</p>
<iframe width="100%" height="500" frameborder="0" scrolling="no" src="food-stamps-column.html"></iframe>


<h3 id="make-a-dot-and-line-chart-comparing-number-of-people-in-poverty-with-number-on-food-stamps-over-time"><a name="make-a-dot-and-line-chart-comparing-number-of-people-in-poverty-with-number-on-food-stamps-over-time" href="#make-a-dot-and-line-chart-comparing-number-of-people-in-poverty-with-number-on-food-stamps-over-time"></a>Make a dot-and-line chart comparing number of people in poverty with number on food stamps over time</h3>
<p>Click your browswer’s back arrow to return to your account’s home page:</p>
<p><img src="./img/basic_charts_15.jpg" alt=""></p>
<p>Now hover over the grid with the food stamps data, and click on <code>Open in: Editor</code> to start making a new chart from the same data.</p>
<p>This time, select <code>Line</code> for the first <code>Trace</code>, and  put <code>food_stamps</code> on the <code>Y</code> axis and <code>year</code> on the <code>X</code>:</p>
<p><img src="./img/basic_charts_16.jpg" alt=""></p>
<p>Now click the <code>+ Trace</code> button to add a second line, and edit so that <code>poverty</code> is mapped to the <code>Y</code> axis.</p>
<p><img src="./img/basic_charts_17.jpg" alt=""></p>
<p>Change the <code>Typeface</code> to Arial as before under the <code>General</code> in the <code>Style</code> menu.</p>
<p>Under <code>Traces</code> in the <code>Style</code> menu, select the <code>By Type</code> tab check <code>Points</code>. (With multiple traces, you can also use the <code>Individually</code> tab to customize them one at a time.) Once you add points to a line chart, Plotly should automatically adjust the <code>Y</code> axis to start at zero.</p>
<p>By default, Plotly has chosen a qualitative palette for <code>categorical scales</code>; you can use the <code>Individually</code> tab to customize the color of each trace individually if you wish. Here I have chosen blue and orange, at opposite sides of the color wheel, and also labelled each <code>Trace</code>:</p>
<p><img src="./img/basic_charts_18.jpg" alt=""></p>
<p>Switch to <code>Axes</code>, and edit the <code>Y</code> axis title to <code>People (millions)</code>:</p>
<p><img src="./img/basic_charts_19.jpg" alt=""></p>
<p>Select <code>Legend</code>, and adjust its <code>Positioning</code>, <code>Orientation</code> and <code>Trace Order</code> as desired:</p>
<p><img src="./img/basic_charts_20.jpg" alt=""></p>
<p>Save the chart and then export/share as before.</p>
<h3 id="make-a-bubble-chart-showing-the-relationship-between-gdp-per-capita-and-life-expectancy-for-the-world's-nations-in-2017"><a name="make-a-bubble-chart-showing-the-relationship-between-gdp-per-capita-and-life-expectancy-for-the-world's-nations-in-2017" href="#make-a-bubble-chart-showing-the-relationship-between-gdp-per-capita-and-life-expectancy-for-the-world's-nations-in-2017"></a>Make a bubble chart showing the relationship between GDP per capita and life expectancy for the world’s nations in 2017</h3>
<p>Click your browser’s back arrow to return to your account’s home page, then select <code>Create&gt;Chart</code> to open a new blank grid. Import the <code>nations_2017.csv</code> file:</p>
<p><img src="./img/basic_charts_21.jpg" alt=""></p>
<p>Add a <code>Trace</code> the default <code>Scatter</code> plot and map <code>gdp_percap</code> onto the <code>X</code> axis and <code>life_expect</code> onto the <code>Y</code>:</p>
<p><img src="./img/basic_charts_22.jpg" alt=""></p>
<p>To color the circles by region, select <code>Transforms</code> under the <code>Structure</code> menu, click <code>+ Transform</code>, select <code>Split</code>, and split by <code>region</code> to color the countries by their region.</p>
<p><img src="./img/basic_charts_23.jpg" alt=""></p>
<p>Under <code>General</code> in the <code>Style</code> menu, set the <code>Typeface</code> to <code>Arial</code>.</p>
<p>In the <code>Style</code> menu under <code>Traces</code>, select the <code>By Type</code> tab, click on the color palette under <code>Points</code> and select <code>Set2</code>, which is a ColorBrewer palette.</p>
<p><img src="./img/basic_charts_24.jpg" alt=""></p>
<p>Scroll further down to select <code>Variable</code> under <code>Size</code> and in the <code>Choose data</code> box select <code>Population</code> to size the circles by the countries’ populations.</p>
<p><img src="./img/basic_charts_25.jpg" alt=""></p>
<p>Scroll further down to select <code>country</code> under <code>Text</code> and check <code>Text</code> under <code>Hover/Tooltip Text</code> so that the tooltip shows country names, as well as the values on the <code>X</code> and <code>Y</code> axes.</p>
<p><img src="./img/basic_charts_26.jpg" alt=""></p>
<p>Under <code>Axes</code>, edit the axis titles, and to mimic the appearance of the chart we saw in the Gapminder video switch the <code>Axis Type</code> to <code>Log</code> for the <code>X</code> axis under <code>Range</code>. For the <code>X</code> axis, also add a <code>Prefix</code> of <code>$</code> under <code>Tick Labels</code>:</p>
<p><img src="./img/basic_charts_27.jpg" alt=""></p>
<p>Under <code>Legend</code> adjust the orientation and position of the legend:</p>
<p><img src="./img/basic_charts_28.jpg" alt=""></p>
<p>Save the chart, and then export/share as before.</p>
<h3 id="further-reading/resources"><a name="further-reading/resources" href="#further-reading/resources"></a>Further reading/resources</h3>
<p><strong><a href="https://help.plot.ly/tutorials/">Plotly Chart Studio Tutorials</a></strong></p>

	</div> <!-- /.container all -->
	<script src="http://code.jquery.com/jquery.min.js"></script>
	<script src="../../js/bootstrap.min.js"></script>
</body>
</html>
