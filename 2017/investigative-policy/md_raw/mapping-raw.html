<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>mapping-raw.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="making-maps-with-carto"><a name="making-maps-with-carto" href="#making-maps-with-carto"></a>Making maps with Carto</h1><h3 id="introducing-carto"><a name="introducing-carto" href="#introducing-carto"></a>Introducing Carto</h3><p><a href="https://carto.com/"><strong>Carto</strong></a> is a cloud-based mapping application that makes it easy to produce interactive, online maps. These maps can include <a href="https://carto.com/docs/faqs/torque/">animations of data over time</a>. It is also a geospatial database, allowing you to process geodata using <a href="https://en.wikipedia.org/wiki/SQL">Structured Query Language</a>.</p><h3 id="the-data-we-will-use"><a name="the-data-we-will-use" href="#the-data-we-will-use"></a>The data we will use</h3><p>Download from <a href="data/mapping.zip">here</a>, unzip the folder and place on your desktop. It contains the following:</p><ul>
<li><p><code>oregon_dams.csv</code> Data on dams in Oregon, from the state’s <a href="http://apps.wrd.state.or.us/apps/misc/dam_inventory/">dams inventory</a>. Contains fields including <code>hazard</code> (High, Significant, or Low)   , and <code>storage</code>, giving the each dam’s capacity in acre feet.</p>
</li><li><p><code>seismic_risk.zip</code> Data on seismic risk for the contiguous US, <a href="https://earthquake.usgs.gov/hazards/hazmaps/conterminous/index.php#2014">calculated by</a> the US Geological Survey. The risk values are in the field <code>acc_val</code>, and represent the peak ground acceleration, expressed as a percentage of the acceleration due to gravity, likely to be experienced with a 2% chance over 50 years. This data is a zipped <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a>, a common format for geographic data. Broadly speaking, a shapefile contains a table of data, which is associated with map geometries that can be polygons, lines, or points.</p>
</li><li><p>We will also later import data from the USGS earthquakes API, for earthquakes since 1960 with a magitude of 5 and above, within a 2,000km radius of the geographic center of Oregon, using this url:</p>
<pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>http://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;latitude=43.9336&amp;amp;longitude=-120.5583&amp;amp;maxradiuskm=2000&amp;amp;minmagnitude=5&amp;amp;format=csv&amp;amp;orderby=time
</code></pre>">http://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;latitude=43.9336&amp;longitude=-120.5583&amp;maxradiuskm=2000&amp;minmagnitude=5&amp;format=csv&amp;orderby=time
</code></pre>
</li></ul><h3 id="our-mapping-task"><a name="our-mapping-task" href="#our-mapping-task"></a>Our mapping task</h3><p>We are going to make a map with three layers:</p><ul>
<li>Choropleth (i.e. a filled map using color) showing the risk of a damaging quake in the state of Oregon.</li><li>A map of scaled circles, showing the amount of water stored in dams in the state judged to be a High or Significant hazard, in high seismic risk zones.</li><li>An animation of historical earthquakes of magnitude 5 and above in the region since 1960.</li></ul><h3 id="import-data-to-carto-and-process-using-sql"><a name="import-data-to-carto-and-process-using-sql" href="#import-data-to-carto-and-process-using-sql"></a>Import data to Carto and process using SQL</h3><p>Login to your Carto account, open the drop-down menu under <code>Maps</code> at top left and switch to <code>Your datasets</code>:</p><p><img src="img/mapping_1.jpg" alt=""></p><p>Then click the <code>NEW DATASET</code> button at top right.</p><p>You should now see the following screen:</p><p><img src="img/mapping_2.jpg" alt=""></p><p>With the <code>Data file</code> tab selected, click the <code>Browse</code> button, navigate to the zipped <code>siesmic_risks.zip</code> shapefile and click <code>Open</code>. Then click the <code>CONNECT DATASET</code> button at bottom right.</p><p>Carto can import geodata in a variety of formats, including CSV, <a href="https://developers.google.com/kml/?hl=en">KML</a>, <a href="http://geojson.org/">GeoJSON</a> as well as shapefiles.</p><p>Once the data has imported, you will see the uploaded data table:</p><p><img src="img/mapping_3.jpg" alt=""></p><p>Notice that, in addition to the fields from the original data, each row has been given a <code>cartodb_id</code>, which is a unique identifier for each. The table also has a field called <code>the_geom</code>. This field is central to how Carto works, defining the geometry of any map you make. These geometries can be points, lines or polygons (areas) — which is what we have here.</p><p>You can rename fields by clicking on the three little blue dots to the right of their names:</p><p><img src="img/mapping_4.jpg" alt=""></p><p>You can sort or order the table by the data in each field by clicking on the blue dots and then using the arrows. And you can change the data type for each field (for example from numbers to strings of text), using the same menu.</p><p>Click <code>PREVIEW</code> at bottom right to see the basic, unstyled map:</p><p><img src="img/mapping_5.jpg" alt=""></p><p>Now click <code>BACK</code> to close that map and click on the circle at top left to return to your datasets:</p><p><img src="img/mapping_6.jpg" alt=""></p><p>Notice that the top menu has a link to <code>DOCUMENTATION</code>, which has links to Cato’s technical manuals.</p><p><img src="img/mapping_7.jpg" alt=""></p><p>The <code>DATA LIBRARY</code> link contains useful datasets that you can import into your own account. We are going to use this to import a map of US states, which we will then use in a SQL query to clips the seismic risk map to the boundaries of Oregon.</p><p>Click the data <code>DATA LIBRARY</code> link, then <code>SEARCH</code> for “states.” Scroll down, navigate to page 2 of the search returns, select the dataset <code>USA states</code> and click the <code>Connect dataset</code> link at top right.</p><p><img src="img/mapping_8.jpg" alt=""></p><p>Notice that the imported dataset contains a field called <code>postal</code> with the states’ two-letter abbreviations:</p><p><img src="img/mapping_9.jpg" alt=""></p><p>Now slide the toggle at bottom right from <code>METADATA</code> to <code>SQL</code>:</p><p><img src="img/mapping_10.jpg" alt=""></p><p>This should open the following panel</p><p><img src="img/mapping_11.jpg" alt=""></p><p>Notice that there is a default query that is simply selecting all the data from the table:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT * FROM ne_50m_admin_1_states
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> ne_50m_admin_1_states
</span></code></pre><p>CartoDB is based on a <a href="http://www.postgresql.org/">PostgreSQL</a> database. It works similarly to SQLite, although the syntax for some queries is a little different. <a href="http://www.postgresqltutorial.com/">Here</a> is a PostgreSQL tutorial, if you would like to learn more.</p><p>Paste the following query into the SQL panel and click <code>APPLY</code>:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT *
FROM ne_50m_admin_1_states
WHERE postal = 'OR'
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> ne_50m_admin_1_states
<span class="hljs-keyword">WHERE</span> postal = <span class="hljs-string">'OR'</span>
</span></code></pre><p>You should now just have one row in your data representing the state of Oregon. You can click <code>Preview</code> to confirm this on a map if you wish.</p><p>Click the three blue dots to the right of the table name and <code>Create Dataset from query</code>:</p><p><img src="img/mapping_12.jpg" alt=""></p><p>Click on the new table’s title and rename as <code>oregon</code>:</p><p><img src="img/mapping_13.jpg" alt=""></p><p>Toggle to the <code>SQL</code> panel again, and paste in this query in place of the default:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT seismic_risk.acc_val, ST_Intersection(seismic_risk.the_geom, oregon.the_geom) AS the_geom
FROM seismic_risk, oregon
WHERE ST_Intersects(seismic_risk.the_geom, oregon.the_geom)
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> seismic_risk.acc_val, ST_Intersection(seismic_risk.the_geom, oregon.the_geom) <span class="hljs-keyword">AS</span> the_geom
<span class="hljs-keyword">FROM</span> seismic_risk, oregon
<span class="hljs-keyword">WHERE</span> ST_Intersects(seismic_risk.the_geom, oregon.the_geom)
</span></code></pre><p>Carto allows you you run spatial/grographic queries using an extension to PostgreSQL called <a href="http://postgis.net/">PostGIS</a>. PostGIS functions can, for instance, calculate distances or areas, and all begin with the prefix <code>ST_</code>. See <a href="http://postgis.net/docs/manual-2.2/PostGIS_Special_Functions_Index.html">here</a> for a full list of PostGIS special functions.</p><p>This query uses the spatial functions <code>ST_Intersection</code>, <a href="https://postgis.net/docs/ST_Intersection.html">which creates a new geometry</a> that is the overlap between the geometries from two tables, and <code>ST_Intersects</code>, <a href="https://postgis.net/docs/ST_Intersects.html">which returns</a> data only for overlaps between two geometries.</p><p>Here, the <code>SELECT</code> clause will return two columns, <code>acc_val</code> from the <code>seismic_risk</code> table, and a new <code>the_geom</code>, which is the part of the <code>seismic_risk.the_geom</code> that overlaps with the <code>oregon.the_geom</code>.</p><p>The <code>FROM</code> clause must name both tables included in the query.</p><p>The <code>WHERE</code> clause ensures that the data returned is only for the overlap between the two geometries.</p><p>Click <code>APPLY</code> to run the query, then create a new dataset from the result, and rename as <code>oregon_seismic</code>:</p><p><img src="img/mapping_14.jpg" alt=""></p><p>The map <code>PREVIEW</code> should look like this:</p><p><img src="img/mapping_15.jpg" alt=""></p><p>Now return to your <code>DATASETS</code>, click the <code>NEW DATASET</code> button again and import the file <code>oregon_dams.csv</code>, which should look like this:</p><p><img src="img/mapping_16.jpg" alt=""></p><p>Notice that <code>the_geom</code> for points is given by their longitude and latitude co-ordinates.</p><p>Click <code>PREVIEW</code> to see the locations of all of the dams:</p><p><img src="img/mapping_17.jpg" alt=""></p><p>We will create a new column in this data to allow us to accurately scale the size of the dams by their <code>storage</code> in acre feet. Click on the three little dots to the right of the header on any of the columns and <code>Add new column</code>.</p><p><img src="img/mapping_18.jpg" alt=""></p><p>Rename the new column as <code>scale</code> and change its data type to <code>Number</code>:</p><p><img src="img/mapping_19.jpg" alt=""></p><p>Now open the <code>SQL</code> panel with the toggle switch and run this query:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>UPDATE oregon_dams
SET scale = sqrt(storage)
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">UPDATE</span> oregon_dams
<span class="hljs-keyword">SET</span> scale = <span class="hljs-keyword">sqrt</span>(storage)
</span></code></pre><p>This is an <code>UDPATE</code> query, which alters a table, rather than selecting data from one or more tables.</p><p>The <code>scale</code> field should now be populated with numbers:</p><p><img src="img/mapping_20.jpg" alt=""></p><p>We have created this field, because Carto only allows you to set the size of circles by their width, not their area. To scale accurately by area, you need to use the square root of the data values, because the area of a circle is propotional to its radius squared, according to the equation <code>π*r^2</code>.</p><p>Now we will run a query to select only the dams judged to be a <code>High</code> or <code>Significant</code> hazard in zones with a seismic hazard <code>acc_value</code> of greater than 40.</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT oregon_dams.*
FROM oregon_dams, oregon_seismic
WHERE ST_Within(oregon_dams.the_geom, oregon_seismic.the_geom) AND oregon_seismic.acc_val &amp;gt;= 40 AND (oregon_dams.hazard = 'High' OR oregon_dams.hazard='Significant')
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> oregon_dams.*
<span class="hljs-keyword">FROM</span> oregon_dams, oregon_seismic
<span class="hljs-keyword">WHERE</span> ST_Within(oregon_dams.the_geom, oregon_seismic.the_geom) <span class="hljs-keyword">AND</span> oregon_seismic.acc_val &gt;= <span class="hljs-number">40</span> <span class="hljs-keyword">AND</span> (oregon_dams.hazard = <span class="hljs-string">'High'</span> <span class="hljs-keyword">OR</span> oregon_dams.hazard=<span class="hljs-string">'Significant'</span>)
</span></code></pre><p>This query uses the spatial function <code>ST_Within</code>, <a href="https://postgis.net/docs/ST_Within.html"> which returns data</a> only if the first geometry is inside the second. The meaning of rest of the <code>WHERE</code> clause should make sense from our earlier SQL class.</p><p><code>APPLY</code> this query, then create a new dataset from the result, and rename as <code>oregon_dams_hazard</code>. In <code>PREVIEW</code>, this dataset should look like this:</p><p><img src="img/mapping_21.jpg" alt=""></p><p>Finally, we will pull in the historical earthquakes data.</p><p>Return to your <code>DATASETS</code>, click <code>NEW DATASET</code> and enter the following into the url.</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>http://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;latitude=43.9336&amp;amp;longitude=-120.5583&amp;amp;maxradiuskm=2000&amp;amp;minmagnitude=5&amp;amp;format=csv&amp;amp;orderby=time
</code></pre>">http://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;latitude=43.9336&amp;longitude=-120.5583&amp;maxradiuskm=2000&amp;minmagnitude=5&amp;format=csv&amp;orderby=time
</code></pre><p>Click <code>SUBMIT</code> and you should see the following screen:</p><p><img src="img/mapping_22.jpg" alt=""></p><p>With tables like this, pulled from an live API, it is possible to have them update automatically on a defined schedule, with a paid-for account, hence the invitation to upgrade.</p><p>However, we will simply <code>CONNECT DATASET</code>, which should look like this:</p><p><img src="img/mapping_23.jpg" alt=""></p><p>Rename this dataset to <code>quakes</code>.</p><h3 id="create-a-map-combining-datasets"><a name="create-a-map-combining-datasets" href="#create-a-map-combining-datasets"></a>Create a map combining datasets</h3><p>Exit the <code>quakes</code> dataset and reopen the <code>oregon_seismic</code> dataset by clicking on its name in your <code>DATASETS</code>. Then click the <code>CREATE MAP</code> button at bottom right.</p><p>If this is your first time using the news Carto Builder interface, you will be aksed if you want to <code>TAKE A TOUR</code>. Instead click <code>EDIT YOUR MAP</code>.</p><p>Rename this map <code>Oregon dams and seismic hazards</code> by clicking on its name at top left:</p><p><img src="img/mapping_24.jpg" alt=""></p><p>Now clickon the <code>ADD</code> button. Select the <code>oregon_dams_hazard</code> layer so that it is highlighted in blue, then click the <code>ADD LAYER</code> button at bottom right.</p><p>You should now see both layers on the same map:</p><p><img src="img/mapping_25.jpg" alt=""></p><h3 id="select-a-basemap"><a name="select-a-basemap" href="#select-a-basemap"></a>Select a basemap</h3><p>Now choose a basemap for your visualization, by clicking the <code>Basemap</code> layer in the left panel. The default is a basemap from Carto called <code>Positron</code>, with the <code>Labels</code> displayed over the data layers.</p><p>This is a good default choice. Take a few minutes to explore the built-in basemap options using the <code>Source</code> and <code>Style</code> options. You are not limited to these basemaps, however.</p><p>To import another tiled basemap from elsewhere on the web, click this icon under <code>Source</code>:</p><p><img src="img/mapping_26.jpg" alt=""></p><p>Now click the blue plus sign under <code>Style</code> to call up the following dialog box:</p><p><img src="img/mapping_27.jpg" alt=""></p><p>The <code>XYZ</code> tab allows you to call in publicly available basemaps using URLs in the following format:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>https://{s}.tiles.mapbox.com/v3/mapbox.world-bright/{z}/{x}/{y}.png
</code></pre>">https://{s}.tiles.mapbox.com/v3/mapbox.world-bright/{z}/{x}/{y}.png
</code></pre><p>We will use this “world bright” basemap, provided by MapBox (see the other basemaps from MapBox <a href="http://a.tiles.mapbox.com/v3/mapbox/maps.html">here</a>). The <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">Leaflet Providers preview</a> is a good place to look for available basemaps from other providers. It previews the maps and also exposes their <code>XYZ</code> URLs:</p><p><img src="img/mapping_28.jpg" alt=""></p><p>Back in Carto, enter the <code>XYZ</code> URL for the MapBox world bright map, above, and click <code>Add basemap</code>. The map should now look like this:</p><p><img src="img/mapping_29.jpg" alt=""></p><p>You can also replace the basemap with a white or colored background by clicking on the paint-pot icon under <code>Source</code>:</p><p><img src="img/mapping_30.jpg" alt=""></p><p>Return to the main layers panel by clicking on the backward-pointing arrow next to <code>Basemap</code>.</p><h3 id="style-the-maps-using-the-point-and-click-interface"><a name="style-the-maps-using-the-point-and-click-interface" href="#style-the-maps-using-the-point-and-click-interface"></a>Style the maps using the point-and-click interface</h3><p>Now click on the <code>oregon_seismic</code> layer to bring up this view:</p><p><img src="img/mapping_31.jpg" alt=""></p><p>At this point, rename the layer <code>Seismic risk</code>.</p><p>Click on <code>STYLE</code>, then the color bar for <code>FILL</code>. Then select <code>BY VALUE</code> and select the <code>acc_val</code> field to color the map by the values for seismic risk:</p><p><img src="img/mapping_32.jpg" alt=""></p><p>The default options divide the data into 5 buckets, or bins, using quantiles. You can explore other options by clicking the three blue dots next to each. You can also select from a range of color palettes, and add labels to your map if desired by checking that box. Click on <code>Custom color set</code> if you wish to set the colors for each bin individually, for instance to use a <a href="http://colorbrewer2.org/">ColorBrewer</a> palette.</p><p>Return to the main layers panel, click on the <code>oregon_dams_hazard</code> layer, and rename to <code>Hazardous dams</code>.</p><p>In the <code>STYLE</code> tab, retain the default aggregation of <code>NONE</code>, and click on the color bar for <code>FILL</code>, then <code>BY VALUE</code>. Select <code>type</code> and the points should be colored using a default qualitative color scheme:</p><p><img src="img/mapping_33.jpg" alt=""></p><p>Click on the color bar for <code>FILL</code>, and then the individual color bars to edit the colors used. Here I have selected a HEX value of <code>#0000FF</code> to make each dam rated as a <code>Significant</code> hazard blue, and <code>#FF8000</code> to make each dam rate <code>High</code> hazard orange:</p><p><img src="img/mapping_34.jpg" alt=""></p><p>(The different aggregation options allow you to create other map types from a points layer, including animations. We will explore these options in the workshop, as time allows.)</p><h3 id="style-using-cartocss"><a name="style-using-cartocss" href="#style-using-cartocss"></a>Style using CartoCSS</h3><p>To exert finer control over the map styling, we can use CartoCSS, which styles maps in much the same way that conventional CSS styles web pages. See <a href="https://github.com/mapbox/carto/blob/master/docs/latest.md">here</a> for a CartoCSS reference.</p><p>Still in the <code>Hazardous dams</code> layer, slide the <code>VALUES/CARTOCSS</code> toggle at bottom-left to <code>CARTOCSS</code></p><p>You should see the following code:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  marker-width: 7;
  marker-fill: ramp([hazard], (#0000ff, #ff8000), (&quot;Significant&quot;, &quot;High&quot;), &quot;=&quot;);
  marker-fill-opacity: 1;
  marker-allow-overlap: true;
  marker-line-width: 1;
  marker-line-color: #FFF;
  marker-line-opacity: 1;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">marker-width</span>:<span class="hljs-value"> <span class="hljs-number">7</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill</span>:<span class="hljs-value"> <span class="hljs-function">ramp</span>([hazard], (<span class="hljs-hexcolor">#0000ff</span>, <span class="hljs-hexcolor">#ff8000</span>), (<span class="hljs-string">"Significant"</span>, <span class="hljs-string">"High"</span>), <span class="hljs-string">"="</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill-opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-allow-overlap</span>:<span class="hljs-value"> true</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-width</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#FFF</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Edit to the following</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  marker-width: [scale]/7;
  marker-fill: ramp([hazard], (#0000ff, #ff8000), (&quot;Significant&quot;, &quot;High&quot;), &quot;=&quot;);
  marker-fill-opacity: 0.5;
  marker-allow-overlap: true;
  marker-line-width: 1;
  marker-line-color: #FFF;
  marker-line-opacity: 1;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">marker-width</span>:<span class="hljs-value"> [scale]/<span class="hljs-number">7</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill</span>:<span class="hljs-value"> <span class="hljs-function">ramp</span>([hazard], (<span class="hljs-hexcolor">#0000ff</span>, <span class="hljs-hexcolor">#ff8000</span>), (<span class="hljs-string">"Significant"</span>, <span class="hljs-string">"High"</span>), <span class="hljs-string">"="</span>)</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill-opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.5</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-allow-overlap</span>:<span class="hljs-value"> true</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-width</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#FFF</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Rather than making the circles making the dam a fixed size, this code scales them by the field <code>scale</code> we made earlier, so that they are scaled by area according to their storage capacity — or the amount of water that could be released if they failed catastrophically. I divided all those values by 7, so that the largest circle does not completely dominate the map.</p><p>Click <code>APPLY</code> and the map should redraw:</p><p><img src="img/mapping_35.jpg" alt=""></p><h3 id="edit-the-legends"><a name="edit-the-legends" href="#edit-the-legends"></a>Edit the legends</h3><p>Select the <code>LEGEND</code> tab for the <code>Hazardous dams</code> layer, edit the <code>TITLE</code> to <code>Scaled by storage capacity</code>.</p><p>Switch to the <code>Seismic risk</code> layer, select the <code>LEGEND</code> tab, uncheck the <code>TITLE</code>, and edit the <code>LEFT LABEL</code> and <code>RIGHT LABEL</code> to <code>Low</code> and <code>High</code> respectively.</p><p><img src="img/mapping_36.jpg" alt=""></p><h3 id="configure-tooltips/pop-ups"><a name="configure-tooltips/pop-ups" href="#configure-tooltips/pop-ups"></a>Configure tooltips/pop-ups</h3><p>Switch to the <code>Hazardous dams</code> layer and select the <code>POP-UP</code> tab. Select <code>Hover</code> and the <code>LIGHT</code> style, and check <code>dam_name</code>, edting the text to <code>Name</code>.</p><p>When you hover over one of the facilities, the map should now look like this:</p><p><img src="img/mappping_37.jpg" alt=""></p><h3 id="add-an-animated-layer-with-the-quakes"><a name="add-an-animated-layer-with-the-quakes" href="#add-an-animated-layer-with-the-quakes"></a>Add an animated layer with the quakes</h3><p>Return to the layers panel and click <code>ADD</code>, selecting the <code>quakes</code> layer. Select this layer,and under the <code>STYLE</code> tab change the aggregation to <code>ANIMATED</code> by clicking this icon:</p><p><img src="img/mapping_38.jpg" alt=""></p><p>Change the <code>FILL</code> color to black (Hex: <code>#000000</code>) and the <code>COLUMN</code> to <code>time</code></p><p>The quakes layer should now be animated.</p><h4 id="configure-the-map-options,-and-publish"><a name="configure-the-map-options,-and-publish" href="#configure-the-map-options,-and-publish"></a>Configure the map options, and publish</h4><p>Return to the main layers panel.</p><p>We are almost ready to publish the map, but before doing so, click the <code>Settings</code> icon at left:</p><p><img src="img/mapping_39.jpg" alt=""></p><p>Experiment with the options. Here the <code>SEARCH BOX</code>, which geocodes locations entered by the user and zooms to them is disabled.</p><p><img src="img/mapping_40.jpg" alt=""></p><p>I strongly recommend disabling the <code>SCROLL WHEEL ZOOM</code> which will otherwise cause the map to zoom unintentionally when someone scrolls down a web page in which the map is embedded.</p><p>Having finished working on the map, click the <code>SHARE</code> button. This will call up the following options:</p><p><img src="img/mapping_41.jpg" alt=""></p><p>Click <code>PUBLISH</code>, than copy the code the code from <code>Embed it</code> to obtain an <a href="http://www.w3schools.com/tags/tag_iframe.asp">iframe</a> which will allow you to embed the map on any web page, in the following format:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;iframe width=&quot;100%&quot; height=&quot;520&quot; frameborder=&quot;0&quot; src=&quot;https://paldhous-new.carto.com/builder/8bb471b8-3db0-11e7-b9fa-0e05a8b3e3d7/embed&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;
</code></pre>">&lt;iframe width="100%" height="520" frameborder="0" src="https://paldhous-new.carto.com/builder/8bb471b8-3db0-11e7-b9fa-0e05a8b3e3d7/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&gt;&lt;/iframe&gt;
</code></pre><p>(Note that you can edit the dimensions of the iframe — here set at <code>100%</code> of the width of the div in which it appears — and <code>520</code> pixels high) as required.)</p><h3 id="further-reading/resources"><a name="further-reading/resources" href="#further-reading/resources"></a>Further reading/resources</h3><p><a href="https://carto.com/docs/tutorials/">Carto tutorials</a></p><p><a href="https://carto.com/academy/">The Map Academy</a><br>A series of exercies in Carto, organized by difficulty.</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
